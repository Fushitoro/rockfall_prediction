<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Rockfall Prediction Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
  <link href="{{ url_for('static', filename='css/dashboard.css') }}" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
</head>

<body>
  <div class="container-fluid px-3 py-3">
    <!-- Header -->
    <header
      class="d-flex flex-column flex-md-row align-items-center justify-content-between py-3 mb-4 border-bottom"
    >
      <div>
        <h1 class="h3 mb-0">RockBotz</h1>
        <small class="text-muted">Real-time monitoring and rock fall prediction system</small>
      </div>
      <div class="d-flex align-items-center mt-3 mt-md-0">
        <span id="connection-status" class="badge bg-success me-3">Connected</span>
        <small id="last-update" class="text-muted">Loading...</small>
      </div>
    </header>

    <!-- Alert Banner -->
    <div
      id="alert-banner"
      class="alert alert-dismissible fade"
      role="alert"
      style="display: none"
      aria-live="assertive"
      aria-atomic="true"
    >
      <div class="d-flex align-items-center">
        <i class="fas fa-exclamation-triangle me-2"></i>
        <div>
          <strong id="alert-title">Alert</strong>
          <div id="alert-message"></div>
        </div>
      </div>
    </div>

    <!-- Current Status and Live Sensors Row -->
    <div class="row g-3 mb-4">
      <!-- Risk Card -->
      <section class="col-12 col-lg-4">
        <div class="card h-100 shadow-sm">
          <div class="card-header bg-primary text-white d-flex align-items-center gap-2">
            <i class="fas fa-shield-alt fa-lg"></i>
            <h5 class="mb-0">Current Risk Level</h5>
          </div>
          <div
            class="card-body d-flex flex-column align-items-center justify-content-center text-center"
          >
            <div class="risk-indicator mb-3" id="risk-indicator" aria-live="polite" aria-atomic="true" role="region">
              <div class="risk-circle" id="risk-circle" tabindex="0" aria-label="Current risk level">
                <span id="risk-level" class="fs-5 fw-bold">LOADING</span>
              </div>
            </div>
            <div class="confidence-bar w-100 mb-3" aria-label="Confidence level">
              <div class="progress" style="height: 28px;">
                <div
                  class="progress-bar"
                  id="confidence-bar"
                  role="progressbar"
                  style="width: 0%"
                  aria-valuemin="0"
                  aria-valuemax="100"
                  aria-valuenow="0"
                >
                  <span id="confidence-text">0%</span>
                </div>
              </div>
            </div>
            <p
              class="recommendation px-3 rounded border-start border-4 border-primary"
              id="recommendation"
              aria-live="polite"
              aria-atomic="true"
            >
              Initializing system...
            </p>
          </div>
        </div>
      </section>

      <!-- Live Sensors Card -->
      <section class="col-12 col-lg-8">
        <div class="card h-100 shadow-sm">
          <div
            class="card-header bg-info text-white d-flex align-items-center gap-2"
          >
            <i class="fas fa-satellite-dish fa-lg"></i>
            <h5 class="mb-0">Live Sensor Readings</h5>
          </div>
          <div class="card-body py-3">
            <div class="row g-3">
              <!-- Sensor Cards -->
              <div class="col-6 col-md-3">
                <div class="sensor-card" tabindex="0" aria-label="Slope Height value">
                  <div class="sensor-icon"><i class="fas fa-ruler-vertical"></i></div>
                  <div class="sensor-label">Slope Height</div>
                  <div class="sensor-value" id="slope-height">-- m</div>
                </div>
              </div>
              <div class="col-6 col-md-3">
                <div class="sensor-card" tabindex="0" aria-label="Slope Angle value">
                  <div class="sensor-icon"><i class="fas fa-angle-left"></i></div>
                  <div class="sensor-label">Slope Angle</div>
                  <div class="sensor-value" id="slope-angle">-- °</div>
                </div>
              </div>
              <div class="col-6 col-md-3">
                <div class="sensor-card" tabindex="0" aria-label="Rainfall value">
                  <div class="sensor-icon"><i class="fas fa-cloud-rain"></i></div>
                  <div class="sensor-label">Rainfall</div>
                  <div class="sensor-value" id="rainfall">-- mm</div>
                </div>
              </div>
              <div class="col-6 col-md-3">
                <div class="sensor-card" tabindex="0" aria-label="Vibration value">
                  <div class="sensor-icon"><i class="fas fa-wave-square"></i></div>
                  <div class="sensor-label">Vibration</div>
                  <div class="sensor-value" id="vibration">--</div>
                </div>
              </div>
              <div class="col-6 col-md-3">
                <div class="sensor-card" tabindex="0" aria-label="Cohesion value">
                  <div class="sensor-icon"><i class="fas fa-compress-arrows-alt"></i></div>
                  <div class="sensor-label">Cohesion</div>
                  <div class="sensor-value" id="cohesion">-- kPa</div>
                </div>
              </div>
              <div class="col-6 col-md-3">
                <div class="sensor-card" tabindex="0" aria-label="Temperature Range value">
                  <div class="sensor-icon"><i class="fas fa-thermometer-half"></i></div>
                  <div class="sensor-label">Temperature Range</div>
                  <div class="sensor-value" id="temperature">-- °C</div>
                </div>
              </div>
              <div class="col-6 col-md-3">
                <div class="sensor-card" tabindex="0" aria-label="Groundwater Depth value">
                  <div class="sensor-icon"><i class="fas fa-tint"></i></div>
                  <div class="sensor-label">Groundwater</div>
                  <div class="sensor-value" id="groundwater">-- m</div>
                </div>
              </div>
              <div class="col-6 col-md-3">
                <div class="sensor-card" tabindex="0" aria-label="RQD value">
                  <div class="sensor-icon"><i class="fas fa-gem"></i></div>
                  <div class="sensor-label">RQD</div>
                  <div class="sensor-value" id="rqd">-- %</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </div>

    <!-- Zone Status Bar -->
    <section class="mb-4">
      <div
        id="zone-status-bar"
        class="zone-bar d-flex justify-content-center gap-3 flex-wrap"
        aria-label="Zone risk statuses"
      >
        <!-- Populated dynamically -->
      </div>
    </section>

    <!-- Charts Row -->
    <div class="row g-4 mb-4">
      <!-- Risk Chart -->
      <section class="col-12 col-lg-6">
        <div class="card h-100 shadow-sm">
          <div
            class="card-header bg-warning text-dark d-flex align-items-center gap-2"
          >
            <i class="fas fa-chart-line fa-lg"></i>
            <h5 class="mb-0">Risk Level History</h5>
          </div>
          <div class="card-body p-3">
            <canvas
              id="riskChart"
              aria-label="Risk confidence chart"
              role="img"
              height="220"
            ></canvas>
          </div>
        </div>
      </section>

      <!-- Sensor Chart -->
      <section class="col-12 col-lg-6">
        <div class="card h-100 shadow-sm">
          <div
            class="card-header bg-success text-white d-flex align-items-center gap-2"
          >
            <i class="fas fa-chart-area fa-lg"></i>
            <h5 class="mb-0">Key Sensor Trends</h5>
          </div>
          <div class="card-body p-3">
            <canvas
              id="sensorChart"
              aria-label="Key sensor parameters chart"
              role="img"
              height="220"
            ></canvas>
          </div>
        </div>
      </section>
    </div>

<!--    &lt;!&ndash; Prediction Table &ndash;&gt;-->
<!--    <section class="mb-5">-->
<!--      <div class="card shadow-sm">-->
<!--        <div-->
<!--          class="card-header bg-secondary text-white d-flex align-items-center gap-2"-->
<!--        >-->
<!--          <i class="fas fa-table fa-lg"></i>-->
<!--          <h5 class="mb-0">Recent Predictions</h5>-->
<!--        </div>-->
<!--        <div class="card-body table-responsive p-0">-->
<!--          <table-->
<!--            class="table table-striped table-hover mb-0"-->
<!--            aria-describedby="recent-predictions"-->
<!--          >-->
<!--            <thead class="table-light">-->
<!--              <tr>-->
<!--                <th>Timestamp</th>-->
<!--                <th class="tooltip" tabindex="0" aria-describedby="tooltip-risklevel">-->
<!--                  Risk Level-->
<!--                  <span class="tooltiptext" role="tooltip" id="tooltip-risklevel"-->
<!--                    >Binary model output: overall rockfall risk level for action.</span-->
<!--                  >-->
<!--                </th>-->
<!--                <th>Confidence</th>-->
<!--                <th-->
<!--                  class="tooltip"-->
<!--                  tabindex="0"-->
<!--                  aria-describedby="tooltip-classification"-->
<!--                >-->
<!--                  Classification-->
<!--                  <span class="tooltiptext" role="tooltip" id="tooltip-classification"-->
<!--                    >Multiclass model output: detailed risk category or condition.</span-->
<!--                  >-->
<!--                </th>-->
<!--                <th>Key Factors</th>-->
<!--              </tr>-->
<!--            </thead>-->
<!--            <tbody id="predictions-table">-->
<!--              <tr>-->
<!--                <td colspan="5" class="text-center py-3">Loading predictions...</td>-->
<!--              </tr>-->
<!--            </tbody>-->
<!--          </table>-->
<!--        </div>-->
<!--      </div>-->
<!--    </section>-->
<!--  </div>-->

  <!-- Loading Overlay -->
  <div
    id="loading-overlay"
    class="loading-overlay"
    aria-hidden="true"
  >
    <div class="loading-spinner" role="status" aria-live="polite">
      <i class="fas fa-spinner fa-spin fa-3x"></i>
      <p class="mt-3 fs-5 text-white">Loading dashboard...</p>
    </div>
  </div>

  <link href="{{ url_for('static', filename='css/dashboard.css') }}" rel="stylesheet" />
<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>

</body>
</html>
